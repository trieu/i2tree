<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>Viewer</title>	
			
		<script type="text/javascript" charset="utf-8" src="jquery.js"></script>
		<script type="text/javascript" src="jquery.mobile-1.1.0.min.js"></script>
		<script type="text/javascript" src="jsrender.js"></script>
		
		<link href="jquery.mobile-1.1.0.min.css" rel="stylesheet" />
		<style type="text/css">
			.ui-header .ui-title { overflow: visible !important;  white-space: normal !important; margin: .6em 30% .8em 15%; }
			.tpl {display: none !important; }
			.e { margin: 2px 3px; border: 1px solid black; border-radius: 10px; padding: 5px;}
			.e .e_header { font: bolder; font-size: 14px;  }
			.e .e_thumb img { max-width:96%; max-height:100%; }
			.e .e_body { font-size: 12px; }
			.e .e_actions {  }
		</style>

	</head>
	<body >
	
		<script id="node_tpl" type="text/x-jsrender">
			<div class="e">
				<h2 class="e_header" >{{>label}}:{{>title}}</h2>
				<div class="e_thumb" ><img alt="" src="{{>thumbnail_url}}"></div>
				<div class="e_body" >{{>content}}</div>
				<div class="e_actions" >						
					<a href="#" data-role="button" data-icon="check">{{>button}}</a> 
				</div>
			</div>
		</script>
	
		<div data-role="page" id="Home">

			<div data-role="header">				
				<h1 class="ui-title" role="heading" aria-level="1">Active Info Network</h1>
				<a href="javascript: alert('option')" data-icon="gear" class="ui-btn-right">Options</a>
			</div>
	
			<div data-role="content">
				<div id="problem_list"></div>		
				<div id="solution_list" style="display: none;"></div>				
			</div>
			
			<div data-role="footer" data-id="foo1" data-position="fixed" >		
				<div data-role="navbar">
					<ul id="home_nav">
						<li><a href="#" for="#problem_list" class="ui-btn-active ui-state-persist" >Problems</a></li>
						<li><a href="#" for="#solution_list"  >Solutions</a></li>						
					</ul>
				</div>
			</div>
			<div id="logs" ></div>
		</div>
		
		
	
	</body>
	
	<script type="text/javascript">
		function log(s) {
			$('#logs').html( $('#logs').html() + "<br>" + s);
		}
		
		function showListView(nav_id) {
			$('#Home div[data-role="content"] > div').hide();
			$(nav_id).html('').show();			
			getData();
		}
		
		function getData(){
			var url = 'http://greengarstudios.com/bt2/index.php/info_node/get_last_ten_nodes?t=' + new Date().getTime();
			var params = {};
			$.get(url, params, function(rs){
				if(rs.status === 'ok'){
					var list = rs.data;
					var container, html = '';		
					for(var i = 0; i< list.length; i++){
										
						if( list[i].is_problem === "1" ){
							container = $('#problem_list');		
							list[i].label = 'Problem';
							list[i].button = 'Solve';
							html = $( "#node_tpl" ).render( list[i] );		
						} else {
							container = $('#solution_list');	
							list[i].label = 'Solution';
							list[i].button = 'Request';
							html = $( "#node_tpl" ).render( list[i] );		
						}
						container.html( container.html() + html).trigger('create');						
					}
				}
				//log(rs.data[0].title);
			});
		}
		getData();
		
		$('#home_nav a').each(function(){
			$(this).tap(function(){
				showListView( $(this).attr('for') );
			});
		});
		
	</script>

</html>
